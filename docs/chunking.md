# Chunking 가이드

이 문서는 Tiny-Graph-RAG에서 긴 문서를 처리 가능한 단위로 나누는 **Chunking** 프로세스와 전략을 설명합니다.

## 1. 개요

LLM은 한 번에 처리할 수 있는 컨텍스트 길이에 제한이 있으며, 너무 긴 텍스트에서는 정보 추출의 정확도가 떨어질 수 있습니다. `TextChunker`는 원본 문서를 의미 있는 최소 단위인 '청크(Chunk)'로 분할하여 지식 추출(`extraction`) 모듈이 효율적으로 작동하도록 돕습니다.

## 2. 전략: Overlapping Window & Boundary Adjustment

Tiny-Graph-RAG는 단순한 글자 수 기반 분할의 단점을 보완하기 위해 두 가지 주요 전략을 사용합니다.

### 2.1 Overlap (중첩)
- **설명**: 인접한 청크 사이에 일정 부분 텍스트를 중복시킵니다.
- **목적**: 문장이 분할 지점에서 잘려 문맥이 손실되거나, 엔티티 간의 관계가 서로 다른 청크로 쪼개져 추출되지 못하는 문제를 방지합니다.
- **기본값**: `chunk_size=1000`, `overlap=200` (글자 수 기준)

### 2.2 Boundary Adjustment (경계 최적화)
- **설명**: 지정된 `chunk_size`에 도달했을 때 무조건 자르는 대신, 근처의 문장 마침표나 줄바꿈을 찾아 자연스러운 지점에서 분할합니다.
- **우선순위**:
    1. 문장 종결 기호 (`. `, `! `, `? ` 등)
    2. 단락 구분 (`

`)
    3. 줄바꿈 (`
`)
- **효과**: 추출 시 문맥의 완성도를 높여 LLM이 엔티티와 관계를 더 정확하게 파악할 수 있게 합니다.

## 3. 주요 파라미터 및 설정

`config.yaml` 또는 `TextChunker` 초기화 시 다음 설정을 조정할 수 있습니다.

| 파라미터 | 기본값 | 설명 |
| :--- | :--- | :--- |
| `chunk_size` | 1000 | 청크의 최대 글자 수. 너무 작으면 관계가 파편화되고, 너무 크면 LLM 추출 누락이 발생할 수 있습니다. |
| `overlap` | 200 | 청크 간 중첩될 글자 수. 일반적으로 `chunk_size`의 10~20%를 권장합니다. |

## 4. 데이터 구조 (Chunk 객체)

분할된 각 청크는 다음과 같은 메타데이터를 포함합니다.
- `text`: 실제 분할된 텍스트 내용
- `chunk_id`: 고유 식별자 (UUID)
- `start_index` / `end_index`: 원본 문서 내에서의 위치 정보
- `doc_id`: 소스 문서 식별자

## 5. 튜닝 가이드

문서의 성격에 따라 설정을 다르게 가져가는 것이 좋습니다.
- **소설/수필**: 문맥 유지가 중요하므로 `overlap`을 충분히(200~300) 가져가는 것이 유리합니다.
- **기술 문서/로그**: 정보가 조밀하므로 `chunk_size`를 작게(500~800) 하고 정확한 추출에 집중하는 것이 좋을 수 있습니다.
- **대화체**: 줄바꿈이 빈번하므로 Boundary Adjustment가 특히 중요하게 작용합니다.
